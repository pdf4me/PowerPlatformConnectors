{
  "properties": {
    "connectionParameterSets": {
      "uiDefinition": {
        "displayname": "Select the authentication type"
      },
      "values": [
        {
          "name": "MSDynamicsCE",
          "uiDefinition": {
            "displayName": "Microsoft Dynamics 365 CE"
          },
          "parameters": {
            "token": {
              "type": "oauthSetting",
              "oAuthSettings": {
                "identityProvider": "oauth2generic",
                "clientId": "<clientId>",
                "scopes": [],
                "redirectMode": "GlobalPerConnector",
                "redirectUrl": "https://global.consent.azure-apim.net/redirect",
                "properties": {
                  "IsFirstParty": "False",
                  "IsOnbehalfofLoginSupported": false
                },
                "customParameters": {
                  "authorizationUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize"
                  },
                  "authorizationUrlQueryStringTemplate":{
                     "value":"?client_id={clientId}&response_type=code&redirect_uri={redirectUrl}&scope=openid%20offline_access%20{ce_url_instance}.default&state={State}"
                  },
                  "tokenUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/token"
                  },
                  "refreshUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/token"
                  },
                  "tokenBodyTemplate":{
                     "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={clientId}&client_secret={clientSecret}&scope=openid%20offline_access%20{ce_url_instance}.default"
                  },
                  "refreshBodyTemplate":{
                     "value":"code={code}&grant_type=refresh_token&refresh_token={refreshToken}&redirect_uri={redirectUrl}&client_id={clientId}&client_secret={clientSecret}&scope=openid%20offline_access%20{ce_url_instance}.default"
                  },
                  "scopeListDelimiter": {
                    "value": " "
                  }
                }
              },
              "uiDefinition": {
                "displayName": "Microsoft Dynamics 365 CE",
                "description": "Connection to your Microsoft Dynamics 365 CE project.",
                "constraints": {
                  "required": "true",
                  "hidden": "false"
                }
              }
            },
            "token:ce_url_instance": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "validations": [
                    {
                      "regex": "^https:\/\/.*\/$",
                      "message": "The URL must start with 'https://' and end with a '/'."
                    }
                  ]
                },
                "description": "The URL to your Microsoft Dynamics 365 CE project.",
                "displayName": "Microsoft Dynamics 365 CE Project URL",
                "tooltip": "Provide the URL to your Microsoft Dynamics 365 CE project."
              }
            },
            "token:cpq_url_instance": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "validations": [
                    {
                      "regex": "^https:\/\/.*\/$",
                      "message": "The URL must start with 'https://' and end with a '/'."
                    }
                  ]
                },
                "description": "The URL to your CPQ project.",
                "displayName": "CPQ Project URL",
                "tooltip": "Provide the URL to your CPQ project."
              }
            },
            "token:organization_name": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true"
                },
                "description": "The name of your Dynamics 365 CE organization.",
                "displayName": "Organization Name",
                "tooltip": "Provide the name of your Dynamics 365 CE organization."
              }
            },
            "token:integration_name": {
              "type": "string",
              "default": "Crm",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "readOnly": "true"
                },
                "description": "The name (type) of the CPQ integration.",
                "displayName": "Integration Name",
                "tooltip": "Provide the name (type) of your CPQ integration."
              }
            }
          }
        },
        {
          "name": "MSDynamicsFO",
          "uiDefinition": {
            "displayName": "Microsoft Finance and Operations"
          },
          "parameters": {
            "token": {
              "type": "oauthSetting",
              "oAuthSettings": {
                "identityProvider": "oauth2generic",
                "clientId": "<clientId>",
                "scopes": [],
                "redirectMode": "GlobalPerConnector",
                "redirectUrl": "https://global.consent.azure-apim.net/redirect",
                "properties": {
                  "IsFirstParty": "False",
                  "IsOnbehalfofLoginSupported": false
                },
                "customParameters": {
                  "authorizationUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize"
                  },
                  "authorizationUrlQueryStringTemplate":{
                     "value":"?client_id={clientId}&response_type=code&redirect_uri={redirectUrl}&scope=openid%20offline_access%20{fo_url_instance}.default&state={State}"
                  },
                  "tokenUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/token"
                  },
                  "refreshUrlTemplate":{
                     "value":"https://login.microsoftonline.com/organizations/oauth2/v2.0/token"
                  },
                  "tokenBodyTemplate":{
                     "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={clientId}&client_secret={clientSecret}&scope=openid%20offline_access%20{fo_url_instance}.default"
                  },
                  "refreshBodyTemplate":{
                     "value":"code={code}&grant_type=refresh_token&refresh_token={refreshToken}&redirect_uri={redirectUrl}&client_id={clientId}&client_secret={clientSecret}&scope=openid%20offline_access%20{fo_url_instance}.default"
                  },
                  "scopeListDelimiter": {
                    "value": " "
                  }
                }
              },
              "uiDefinition": {
                "displayName": "Microsoft Dynamics 365 CE",
                "description": "Connection to your Microsoft Dynamics 365 CE project.",
                "constraints": {
                  "required": "true",
                  "hidden": "false"
                }
              }
            },
            "token:fo_url_instance": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "validations": [
                    {
                      "regex": "^https:\/\/.*\/$",
                      "message": "The URL must start with 'https://' and end with a '/'."
                    }
                  ]
                },
                "description": "The URL to your Microsoft Dynamics Finance and Operations project.",
                "displayName": "Microsoft Dynamics Finance and Operations Project URL",
                "tooltip": "Provide the URL to your Microsoft Dynamics Finance and Operations project."
              }
            },
            "token:cpq_url_instance": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "validations": [
                    {
                      "regex": "^https:\/\/.*\/$",
                      "message": "The URL must start with 'https://' and end with a '/'."
                    }
                  ]
                },
                "description": "The URL to your CPQ project.",
                "displayName": "CPQ Project URL",
                "tooltip": "Provide the URL to your CPQ project."
              }
            },
            "token:organization_name": {
              "type": "string",
              "uiDefinition": {
                "constraints": {
                  "required": "true"
                },
                "description": "The name of your Dynamics Finance and Operations organization.",
                "displayName": "Organization Name",
                "tooltip": "Provide the name of your Dynamics Finance and Operations organization."
              }
            },
            "token:integration_name": {
              "type": "string",
              "default": "Ax",
              "uiDefinition": {
                "constraints": {
                  "required": "true",
                  "readOnly": "true"
                },
                "description": "The name (type) of the CPQ integration.",
                "displayName": "Integration Name",
                "tooltip": "Provide the name (type) of your CPQ integration."
              }
            }
          }
        }
      ]
    },
    "iconBrandColor": "#007ee5",
    "capabilities": [],
    "publisher": "Experlogix",
    "policyTemplateInstances": [
      {
        "templateId": "setheader",
        "title": "CpqUrlHeaderPolicy",
        "parameters": {
          "x-ms-apimTemplateParameter.name": "X-Cpq-Url",
          "x-ms-apimTemplateParameter.value": "@connectionParameters('token:cpq_url_instance')",
          "x-ms-apimTemplateParameter.existsAction": "override",
          "x-ms-apimTemplate-policySection": "Request"
        }
      },
      {
        "templateId": "setheader",
        "title": "OrganizationNameHeaderPolicy",
        "parameters": {
          "x-ms-apimTemplateParameter.name": "X-Organization-Name",
          "x-ms-apimTemplateParameter.value": "@connectionParameters('token:organization_name')",
          "x-ms-apimTemplateParameter.existsAction": "override",
          "x-ms-apimTemplate-policySection": "Request"
        }
      },
      {
        "templateId": "setheader",
        "title": "IntegrationNameHeaderPolicy",
        "parameters": {
          "x-ms-apimTemplateParameter.name": "X-Integration-Name",
          "x-ms-apimTemplateParameter.value": "@connectionParameters('token:integration_name')",
          "x-ms-apimTemplateParameter.existsAction": "override",
          "x-ms-apimTemplate-policySection": "Request"
        }
      }
    ]
  }
}